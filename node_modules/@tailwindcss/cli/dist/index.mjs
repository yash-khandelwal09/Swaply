#!/usr/bin/env node
import ue from"mri";function J(e,t=process.argv.slice(2)){let i=ue(t),n={_:i._};for(let[r,{type:o,alias:c,default:p=o==="boolean"?!1:null}]of Object.entries(e)){if(n[r]=p,c){let l=c.slice(1);i[l]!==void 0&&(n[r]=V(i[l],o))}{let l=r.slice(2);i[l]!==void 0&&(n[r]=V(i[l],o))}}return n}function V(e,t){switch(t){case"string":return D(e);case"boolean":return _(e);case"number":return E(e);case"boolean | string":return _(e)??D(e);case"number | string":return E(e)??D(e);case"boolean | number":return _(e)??E(e);case"boolean | number | string":return _(e)??E(e)??D(e);default:throw new Error(`Unhandled type: ${t}`)}}function _(e){if(e===!0||e===!1)return e;if(e==="true")return!0;if(e==="false")return!1}function E(e){if(typeof e=="number")return e;{let t=Number(e);if(!Number.isNaN(t))return t}}function D(e){return`${e}`}import be from"@parcel/watcher";import{compile as we,env as u}from"@tailwindcss/node";import{clearRequireCache as ye}from"@tailwindcss/node/require-cache";import{Scanner as te}from"@tailwindcss/oxide";import{Features as ie,transform as Se}from"lightningcss";import{existsSync as xe}from"node:fs";import j from"node:fs/promises";import $ from"node:path";var T=class{#e=new Set([]);queueMacrotask(t){let i=setTimeout(t,0);return this.add(()=>{clearTimeout(i)})}add(t){return this.#e.add(t),()=>{this.#e.delete(t),t()}}dispose(){for(let t of this.#e)t();this.#e.clear()}};import fe from"node:fs";import X from"node:path";import{stripVTControlCharacters as me}from"node:util";import m from"picocolors";import Q from"enhanced-resolve";import ce from"node:fs";import{createRequire as pe}from"node:module";var de=pe(import.meta.url).resolve;function Y(e){if(typeof globalThis.__tw_resolve=="function"){let t=globalThis.__tw_resolve(e);if(t)return t}return de(e)}var Ue=Q.ResolverFactory.createResolver({fileSystem:new Q.CachedInputFileSystem(ce,4e3),useSyncFileSystemCalls:!0,extensions:[".css"],mainFields:["style"],conditionNames:["style"]});function H(e){let t=typeof e=="number"?BigInt(e):e;return t<1000n?`${t}ns`:(t/=1000n,t<1000n?`${t}\xB5s`:(t/=1000n,t<1000n?`${t}ms`:(t/=1000n,t<60n?`${t}s`:(t/=60n,t<60n?`${t}m`:(t/=60n,t<24n?`${t}h`:(t/=24n,`${t}d`))))))}var U={indent:2};function C(){return`${m.italic(m.bold(m.blue("\u2248")))} tailwindcss ${m.blue(`v${he()}`)}`}function G(e){return`${m.dim(m.blue("`"))}${m.blue(e)}${m.dim(m.blue("`"))}`}function Z(e,t=process.cwd(),{preferAbsoluteIfShorter:i=!0}={}){let n=X.relative(t,e);return n.startsWith("..")||(n=`.${X.sep}${n}`),i&&n.length>e.length?e:n}function W(e,t){let i=e.split(" "),n=[],r="",o=0;for(let c of i){let p=me(c).length;o+p+1>t&&(n.push(r),r="",o=0),r+=(o?" ":"")+c,o+=p+(o?1:0)}return o&&n.push(r),n}function k(e){let t=H(e);return e<=50*1e6?m.green(t):e<=300*1e6?m.blue(t):e<=1e3*1e6?m.yellow(t):m.red(t)}function B(e,t=0){return`${" ".repeat(t+U.indent)}${e}`}function b(e=""){process.stderr.write(`${e}
`)}function d(e=""){process.stdout.write(`${e}
`)}function he(){if(typeof globalThis.__tw_version=="string")return globalThis.__tw_version;let{version:e}=JSON.parse(fe.readFileSync(Y("tailwindcss/package.json"),"utf-8"));return e}import I from"node:fs/promises";import ge from"node:path";function M(){return new Promise((e,t)=>{let i="";process.stdin.on("data",n=>{i+=n}),process.stdin.on("end",()=>e(i)),process.stdin.on("error",n=>t(n))})}async function ee(e,t){try{if(await I.readFile(e,"utf8")===t)return}catch{}await I.mkdir(ge.dirname(e),{recursive:!0}),await I.writeFile(e,t,"utf8")}var ne=String.raw;function F(){return{"--input":{type:"string",description:"Input file",alias:"-i"},"--output":{type:"string",description:"Output file",alias:"-o"},"--watch":{type:"boolean | string",description:"Watch for changes and rebuild as needed",alias:"-w"},"--minify":{type:"boolean",description:"Optimize and minify the output",alias:"-m"},"--optimize":{type:"boolean",description:"Optimize the output without minifying"},"--cwd":{type:"string",description:"The current working directory",default:"."}}}async function se(e){let t=$.resolve(e["--cwd"]);e["--output"]&&(e["--output"]=$.resolve(t,e["--output"])),e["--input"]&&e["--input"]!=="-"&&(e["--input"]=$.resolve(t,e["--input"]),xe(e["--input"])||(b(C()),b(),b(`Specified input file ${G(Z(e["--input"]))} does not exist.`),process.exit(1)));let i=process.hrtime.bigint(),n=e["--input"]?e["--input"]==="-"?await M():await j.readFile(e["--input"],"utf-8"):ne`
        @import 'tailwindcss';
      `,r={css:"",optimizedCss:""};async function o(f,h){let g=f;if(h["--minify"]||h["--optimize"])if(f!==r.css){u.DEBUG&&console.time("[@tailwindcss/cli] Optimize CSS");let w=$e(f,{file:h["--input"]??"input.css",minify:h["--minify"]??!1});u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Optimize CSS"),r.css=f,r.optimizedCss=w,g=w}else g=r.optimizedCss;u.DEBUG&&console.time("[@tailwindcss/cli] Write output"),h["--output"]?await ee(h["--output"],g):d(g),u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Write output")}let c=e["--input"]&&e["--input"]!=="-"?$.dirname($.resolve(e["--input"])):process.cwd(),p=[];async function l(f){u.DEBUG&&console.time("[@tailwindcss/cli] Setup compiler");let h=await we(f,{base:c,onDependency(g){p.push(g)}});return u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Setup compiler"),h}let a=await l(n),s=new te({detectSources:{base:t},sources:a.globs});if(e["--watch"]){let f=await oe(re(t,s),async function h(g){try{if(g.length===1&&g[0]===e["--output"])return;let w=[],O="incremental",K=p;for(let y of g){if(K.includes(y)){O="full";break}w.push({file:y,extension:$.extname(y).slice(1)})}let L=process.hrtime.bigint(),N="";if(O==="full"){f();let y=e["--input"]?e["--input"]==="-"?await M():await j.readFile(e["--input"],"utf-8"):ne`
                  @import 'tailwindcss';
                `;ye(K),p=[],a=await l(y),s=new te({detectSources:{base:t},sources:a.globs}),u.DEBUG&&console.time("[@tailwindcss/cli] Scan for candidates");let z=s.scan();u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Scan for candidates"),f=await oe(re(t,s),h),u.DEBUG&&console.time("[@tailwindcss/cli] Build CSS"),N=a.build(z),u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Build CSS")}else if(O==="incremental"){u.DEBUG&&console.time("[@tailwindcss/cli] Scan for candidates");let y=s.scanFiles(w);if(u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Scan for candidates"),y.length<=0){let z=process.hrtime.bigint();b(`Done in ${k(z-L)}`);return}u.DEBUG&&console.time("[@tailwindcss/cli] Build CSS"),N=a.build(y),u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Build CSS")}await o(N,e);let ae=process.hrtime.bigint();b(`Done in ${k(ae-L)}`)}catch(w){w instanceof Error&&b(w.toString())}});e["--watch"]!=="always"&&process.stdin.on("end",()=>{f(),process.exit(0)}),process.stdin.resume()}u.DEBUG&&console.time("[@tailwindcss/cli] Scan for candidates");let x=s.scan();u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Scan for candidates"),u.DEBUG&&console.time("[@tailwindcss/cli] Build CSS");let v=a.build(x);u.DEBUG&&console.timeEnd("[@tailwindcss/cli] Build CSS"),await o(v,e);let A=process.hrtime.bigint();b(C()),b(),b(`Done in ${k(A-i)}`)}function re(e,t){return[e].concat(t.globs.flatMap(i=>i.pattern[0]==="!"?[]:i.base.startsWith(e)?[]:i.base))}async function oe(e,t){let i=new T,n=new Set,r=new T;function o(){r.dispose(),r.queueMacrotask(()=>{t(Array.from(n)),n.clear()})}for(let c of e){let{unsubscribe:p}=await be.subscribe(c,async(l,a)=>{if(l){console.error(l);return}await Promise.all(a.map(async s=>{s.type==="delete"||(await j.lstat(s.path)).isDirectory()||n.add(s.path)})),o()});i.add(p)}return()=>{i.dispose(),r.dispose()}}function $e(e,{file:t="input.css",minify:i=!1}={}){return Se({filename:t,code:Buffer.from(e),minify:i,sourceMap:!1,drafts:{customMedia:!0},nonStandard:{deepSelectorCombinator:!0},include:ie.Nesting,exclude:ie.LogicalProperties,targets:{safari:16<<16|1024},errorRecovery:!0}).code.toString()}import S from"picocolors";function P({invalid:e,usage:t,options:i}){let n=process.stdout.columns;if(d(C()),e&&(d(),d(`${S.dim("Invalid command:")} ${e}`)),t&&t.length>0){d(),d(S.dim("Usage:"));for(let[r,o]of t.entries()){let c=o.slice(0,o.indexOf("[")),p=o.slice(o.indexOf("["));p=p.replace(/\[.*?\]/g,s=>S.dim(s));let a=W(p,n-U.indent-c.length-1);a.length>1&&r!==0&&d(),d(B(`${c}${a.shift()}`));for(let s of a)d(B(s,c.length))}}if(i){let r=0;for(let{alias:l}of Object.values(i))l&&(r=Math.max(r,l.length));let o=[],c=0;for(let[l,{alias:a}]of Object.entries(i)){let s=[a&&`${a.padStart(r)}`,a?l:" ".repeat(r+2)+l].filter(Boolean).join(", ");o.push(s),c=Math.max(c,s.length)}d(),d(S.dim("Options:"));let p=8;for(let{description:l,default:a=null}of Object.values(i)){let s=o.shift(),x=p+(c-s.length),v=2,A=n-s.length-x-v-U.indent,f=W(a!==null?`${l} ${S.dim(`[default:\u202F${G(`${a}`)}]`)}`:l,A);d(B(`${S.blue(s)} ${S.dim(S.gray("\xB7")).repeat(x)} ${f.shift()}`));for(let h of f)d(B(`${" ".repeat(s.length+x+v)}${h}`))}}}var q={"--help":{type:"boolean",description:"Display usage information",alias:"-h"}},R=J({...F(),...q}),le=R._[0];le&&(P({invalid:le,usage:["tailwindcss [options]"],options:{...F(),...q}}),process.exit(1));(process.stdout.isTTY&&!R["--output"]||R["--help"])&&(P({usage:["tailwindcss [--input input.css] [--output output.css] [--watch] [options\u2026]"],options:{...F(),...q}}),process.exit(0));se(R);
