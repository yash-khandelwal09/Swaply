{% extends "base.html" %} 
{% block content %}

<section class="bg-theme-gradient text-white py-20 relative overflow-hidden">
    <div class="max-w-7xl mx-auto px-4 text-center relative z-10">
        <h1 class="text-5xl md:text-7xl font-bold mb-6 leading-tight">
            Welcome to <span class="text-white drop-shadow-lg">SWAPLY</span>
        </h1>
        <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto leading-relaxed text-white/95">
            Delhi's smartest platform for buying & selling books
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href="{{ url_for('books') }}"
                class="bg-white text-theme-primary px-8 py-4 rounded-xl font-bold hover:bg-gray-100 transition duration-300 text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                üõí Shop Books
            </a>
        </div>
    </div>
    
    <!-- Fallback solid background -->
    <div class="absolute inset-0 bg-theme-primary -z-10"></div>
</section>

<!-- Features Section -->
<section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-4xl md:text-5xl font-bold text-center text-theme-text mb-4">
            Why Choose SWAPLY?
        </h2>
        <p class="text-theme-text-light text-center mb-12 text-lg max-w-2xl mx-auto">
            Buy Smart, Sell Smart - Your trusted book exchange platform
        </p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Feature 1 -->
            <div
                class="text-center p-8 bg-gradient-to-b from-white to-theme-bg-light rounded-2xl shadow-lg hover:shadow-xl transition duration-300 border border-theme-light">
                <div class="w-20 h-20 bg-theme-bg rounded-full flex items-center justify-center mx-auto mb-6">
                    <span class="text-3xl">üí∞</span>
                </div>
                <h3 class="text-2xl font-bold text-theme-text mb-4">Affordable Books</h3>
                <p class="text-theme-text-light leading-relaxed">
                    Get books at affordable prices from readers across Delhi. Build your collection without breaking the bank!
                </p>
            </div>

            <!-- Feature 2 -->
            <div
                class="text-center p-8 bg-gradient-to-b from-white to-theme-bg-light rounded-2xl shadow-lg hover:shadow-xl transition duration-300 border border-theme-light">
                <div class="w-20 h-20 bg-theme-bg rounded-full flex items-center justify-center mx-auto mb-6">
                    <span class="text-3xl">üõ°Ô∏è</span>
                </div>
                <h3 class="text-2xl font-bold text-theme-text mb-4">Verified Users</h3>
                <p class="text-theme-text-light leading-relaxed">
                    All users are properly verified for safe transactions. Connect with genuine book lovers in Delhi.
                </p>
            </div>

            <!-- Feature 3 -->
            <div
                class="text-center p-8 bg-gradient-to-b from-white to-theme-bg-light rounded-2xl shadow-lg hover:shadow-xl transition duration-300 border border-theme-light">
                <div class="w-20 h-20 bg-theme-bg rounded-full flex items-center justify-center mx-auto mb-6">
                    <span class="text-3xl">‚ö°</span>
                </div>
                <h3 class="text-2xl font-bold text-theme-text mb-4">Quick Delivery</h3>
                <p class="text-theme-text-light leading-relaxed">
                    Fast delivery service across Delhi. Get your books delivered quickly and conveniently to your doorstep.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Latest Books Section -->
<section class="py-16 bg-theme-bg-light">
    <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-4xl font-bold text-center text-theme-text mb-4">
            Recently Added Books
        </h2>
        <p class="text-theme-text-light text-center mb-12 text-lg">
            Check out the latest books available for purchase
        </p>

        {% if latest_books %}
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {% for book in latest_books %}
            <div
                class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-2xl transition duration-300 transform hover:-translate-y-2 border border-theme-light">
                <div class="p-6">
                    <!-- Book Condition & Price -->
                    <div class="flex justify-between items-start mb-4">
                        <span class="bg-theme-bg text-theme-primary text-sm px-3 py-1 rounded-full font-semibold">
                            {{ book.condition or 'Good' }}
                        </span>
                        <span class="text-2xl font-bold text-theme-primary">‚Çπ{{ book.price | default(0) }}</span>
                    </div>

                    <!-- Book Title & Author -->
                    <h3 class="text-xl font-bold text-theme-text mb-2">
                        {{ book.title }}
                    </h3>
                    <p class="text-theme-text-light mb-3">by {{ book.author }}</p>

                    <!-- Book Description -->
                    {% if book.description %}
                    <p class="text-theme-text mb-4 text-sm leading-relaxed line-clamp-2">
                        {{ book.description }}
                    </p>
                    {% endif %}

                    <!-- Action Buttons -->
                    <div class="mt-4 pt-4 border-t border-theme-light space-y-3">
                        {% if session.user_id %}
                        <button onclick="addToCart('{{ book.id }}')"
                            class="w-full bg-theme-primary text-white text-center py-3 rounded-xl hover:bg-theme-secondary transition duration-300 font-semibold add-to-cart-btn shadow-md hover:shadow-lg">
                            üõí Add to Cart
                        </button>
                        <a href="/checkout?book_id={{ book.id }}"
                            class="w-full bg-theme-gradient text-white text-center py-3 rounded-xl hover:opacity-90 transition duration-300 font-semibold buy-now-btn block shadow-md hover:shadow-lg">
                            ‚ö° Buy Now
                        </a>
                        {% else %}
                        <a href="/login"
                            class="w-full bg-theme-primary text-white text-center py-3 rounded-xl hover:bg-theme-secondary transition duration-300 font-semibold block shadow-md hover:shadow-lg">
                            üîê Login to Order
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12 bg-white rounded-2xl shadow-lg border border-theme-light">
            <p class="text-theme-text-light text-xl mb-4">No books available yet.</p>
            <p class="text-theme-text-light mb-6">Check back soon for new book listings!</p>
        </div>
        {% endif %}

        <div class="text-center mt-12">
            <a href="{{ url_for('books') }}"
                class="bg-theme-dark text-white px-8 py-4 rounded-xl hover:bg-theme-text transition duration-300 font-bold text-lg shadow-lg hover:shadow-xl inline-flex items-center gap-2">
                üîç View All Books
                <span class="text-xl">‚Üí</span>
            </a>
        </div>
    </div>
</section>

<!-- Community Section -->
<section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4">
        <div class="text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-theme-text mb-4">
                Join Delhi's Growing Book Community
            </h2>
            <p class="text-theme-text-light text-lg max-w-2xl mx-auto mb-8">
                Connect with fellow readers, exchange stories, and build your perfect book collection
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="{{ url_for('books') }}"
                    class="bg-theme-primary text-white px-8 py-4 rounded-xl hover:bg-theme-secondary transition duration-300 font-bold text-lg shadow-lg hover:shadow-xl">
                    üìö Browse Books
                </a>
                <a href="mailto:swaply.swap@gmail.com"
                    class="bg-theme-dark text-white px-8 py-4 rounded-xl hover:bg-theme-text transition duration-300 font-bold text-lg shadow-lg hover:shadow-xl">
                    üìñ Sell Your Books
                </a>
            </div>
        </div>
    </div>
</section>

<!-- How It Works Section -->
<section class="py-16 bg-theme-bg">
    <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-4xl font-bold text-center text-theme-text mb-4">
            How SWAPLY Works
        </h2>
        <p class="text-theme-text-light text-center mb-12 text-lg max-w-2xl mx-auto">
            Simple steps to buy and sell books in Delhi
        </p>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <!-- Step 1 -->
            <div class="text-center bg-white p-8 rounded-2xl shadow-lg border border-theme-light">
                <div class="w-16 h-16 bg-theme-primary text-white rounded-full flex items-center justify-center mx-auto mb-6 text-2xl font-bold shadow-md">
                    1
                </div>
                <h3 class="text-2xl font-bold text-theme-text mb-4">Browse Books</h3>
                <p class="text-theme-text-light leading-relaxed">
                    Find your required books from our collection. Search by title, author, or category.
                </p>
            </div>

            <!-- Step 2 -->
            <div class="text-center bg-white p-8 rounded-2xl shadow-lg border border-theme-light">
                <div class="w-16 h-16 bg-theme-primary text-white rounded-full flex items-center justify-center mx-auto mb-6 text-2xl font-bold shadow-md">
                    2
                </div>
                <h3 class="text-2xl font-bold text-theme-text mb-4">Login & Order</h3>
                <p class="text-theme-text-light leading-relaxed">
                    Secure user verification process. Add to cart or buy directly with easy checkout.
                </p>
            </div>

            <!-- Step 3 -->
            <div class="text-center bg-white p-8 rounded-2xl shadow-lg border border-theme-light">
                <div class="w-16 h-16 bg-theme-primary text-white rounded-full flex items-center justify-center mx-auto mb-6 text-2xl font-bold shadow-md">
                    3
                </div>
                <h3 class="text-2xl font-bold text-theme-text mb-4">Get Delivery</h3>
                <p class="text-theme-text-light leading-relaxed">
                    Books delivered across Delhi. Fast and reliable delivery to your doorstep.
                </p>
            </div>

            <!-- Step 4 -->
            <div class="text-center bg-white p-8 rounded-2xl shadow-lg border border-theme-light">
                <div class="w-16 h-16 bg-theme-primary text-white rounded-full flex items-center justify-center mx-auto mb-6 text-2xl font-bold shadow-md">
                    4
                </div>
                <h3 class="text-2xl font-bold text-theme-text mb-4">Sell Your Books</h3>
                <p class="text-theme-text-light leading-relaxed">
                    Contact us at swaply.swap@gmail.com to sell your books and join our community.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Toast Notification -->
<div id="toast" class="fixed top-4 right-4 hidden p-4 rounded-lg shadow-lg text-white font-medium z-50 transform transition-all duration-300 translate-x-full"></div>

<script>
// Add to Cart functionality
function addToCart(bookId) {
    console.log("üõí Add to Cart clicked for book:", bookId);
    
    fetch('/api/add-to-cart', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            book_id: bookId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('Book added to cart!', 'success');
            updateCartCount();
        } else {
            showToast(data.error || 'Failed to add to cart', 'error');
        }
    })
    .catch(error => {
        console.error('Error adding to cart:', error);
        showToast('Network error. Please try again.', 'error');
    });
}

function updateCartCount() {
    // Update cart count in navbar
    fetch('/api/get-cart')
        .then(response => response.json())
        .then(data => {
            const cartCountElements = document.querySelectorAll('.cart-count');
            cartCountElements.forEach(element => {
                if (data.count > 0) {
                    element.textContent = data.count;
                    element.classList.remove('hidden');
                } else {
                    element.classList.add('hidden');
                }
            });
        })
        .catch(error => {
            console.error('Error updating cart count:', error);
        });
}

function showToast(message, type = 'info') {
    const toast = document.getElementById('toast');
    const bgColor = type === 'success' ? 'bg-theme-primary' : 
                    type === 'error' ? 'bg-red-500' : 
                    'bg-blue-500';
    
    toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white font-medium z-50 transform transition-all duration-300 ${bgColor}`;
    toast.textContent = message;
    toast.classList.remove('hidden', 'translate-x-full');
    
    setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => toast.classList.add('hidden'), 300);
    }, 3000);
}

// Make functions globally available
window.addToCart = addToCart;
</script>
{% endblock %}